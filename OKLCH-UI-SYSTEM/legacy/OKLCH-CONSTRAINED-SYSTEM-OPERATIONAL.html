<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OKLCH Constrained System - Dynamic Enforcement</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* System Colors - Dynamically Constrained */
            --bg: oklch(15% 0.01 250);
            --surface: oklch(20% 0.01 250);
            --text: oklch(95% 0.01 250);         /* Auto-adjusts to bg */
            --text-secondary: oklch(75% 0.02 250); /* Auto-adjusts to bg */
            --primary: oklch(60% 0.15 240);
            --primary-text: oklch(100% 0 0);    /* Auto-adjusts to primary */

            --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-mono: 'SF Mono', Consolas, monospace;
        }

        body {
            font-family: var(--font-sans);
            background: var(--bg);
            color: var(--text);
        }

        .layout {
            display: grid;
            grid-template-columns: 380px 1fr 320px;
            height: 100vh;
            gap: 2px;
            background: oklch(25% 0.02 250);
        }

        .panel {
            background: var(--surface);
            overflow-y: auto;
            padding: 1.5rem;
        }

        h1 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--primary), oklch(70% 0.18 180));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section {
            background: var(--bg);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
            color: var(--primary);
        }

        .control-group {
            margin-bottom: 1rem;
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-bottom: 0.4rem;
            color: var(--text-secondary);
        }

        .value-display {
            font-family: var(--font-mono);
            font-weight: 600;
        }

        .slider-container {
            position: relative;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            appearance: none;
            background: linear-gradient(90deg, #333, #666);
            position: relative;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        /* Legal zone indicator on slider */
        .legal-zone {
            position: absolute;
            top: 0;
            height: 6px;
            background: rgba(0, 255, 0, 0.3);
            pointer-events: none;
            border-radius: 3px;
        }

        .illegal-zone {
            position: absolute;
            top: 0;
            height: 6px;
            background: rgba(255, 0, 0, 0.2);
            pointer-events: none;
        }

        .constraint-warning {
            font-size: 0.75rem;
            color: oklch(65% 0.18 25);
            margin-top: 0.3rem;
            display: none;
        }

        .constraint-warning.active {
            display: block;
        }

        .color-preview {
            width: 100%;
            height: 80px;
            border-radius: 8px;
            border: 2px solid oklch(30% 0.02 250);
            margin-top: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 700;
            position: relative;
        }

        .contrast-badge {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .badge-pass { background: oklch(65% 0.15 145); color: white; }
        .badge-fail { background: oklch(60% 0.18 25); color: white; }

        /* Relationship Graph */
        .relationship-graph {
            background: var(--bg);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .relationship {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.8rem;
            padding: 0.6rem;
            background: var(--surface);
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .rel-color {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: 2px solid oklch(30% 0.02 250);
            flex-shrink: 0;
        }

        .rel-arrow {
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        .rel-info {
            flex: 1;
        }

        .rel-ratio {
            font-family: var(--font-mono);
            font-weight: 700;
            margin-top: 0.2rem;
        }

        .rel-ratio.pass { color: oklch(65% 0.15 145); }
        .rel-ratio.fail { color: oklch(60% 0.18 25); }

        /* Preview Components */
        .preview-panel {
            background: var(--bg);
            padding: 2rem;
        }

        .preview-title {
            font-size: 2rem;
            margin-bottom: 2rem;
            color: var(--text);
        }

        .component-demo {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .demo-title {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            background: var(--primary);
            color: var(--primary-text);
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .card {
            background: var(--bg);
            border: 2px solid oklch(30% 0.02 250);
            border-radius: 10px;
            padding: 1.2rem;
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.6rem;
            color: var(--text);
        }

        .card-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Canvas for 3D visualization */
        #canvas3d {
            width: 100%;
            height: 280px;
            background: var(--bg);
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .zone-legend {
            display: flex;
            gap: 1rem;
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .legend-box {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .legend-legal { background: rgba(0, 255, 0, 0.5); }
        .legend-illegal { background: rgba(255, 0, 0, 0.3); }

        .auto-adjust-indicator {
            font-size: 0.75rem;
            color: oklch(70% 0.12 180);
            margin-top: 0.3rem;
            display: none;
        }

        .auto-adjust-indicator.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="layout">
        <!-- LEFT: Color Controls with Constraints -->
        <div class="panel">
            <h1>üé® Constrained Color System</h1>

            <!-- Background Color (Base Constraint) -->
            <div class="section">
                <div class="section-title">Background Color (Constraint Source)</div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Lightness (L)</span>
                        <span class="value-display" id="valueBgL">15%</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" class="slider" id="sliderBgL" min="0" max="100" value="15">
                    </div>
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Chroma (C)</span>
                        <span class="value-display" id="valueBgC">0.01</span>
                    </div>
                    <input type="range" class="slider" id="sliderBgC" min="0" max="37" value="1">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Hue (H)</span>
                        <span class="value-display" id="valueBgH">250¬∞</span>
                    </div>
                    <input type="range" class="slider" id="sliderBgH" min="0" max="360" value="250">
                </div>

                <div class="color-preview" id="previewBg" style="background: var(--bg);">
                    Background
                </div>
            </div>

            <!-- Text Color (Constrained by Background) -->
            <div class="section">
                <div class="section-title">Text Color (Auto-Constrained)</div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Lightness (L)</span>
                        <span class="value-display" id="valueTextL">95%</span>
                    </div>
                    <div class="slider-container">
                        <div class="legal-zone" id="legalZoneTextL"></div>
                        <input type="range" class="slider" id="sliderTextL" min="0" max="100" value="95">
                    </div>
                    <div class="constraint-warning" id="warningTextL">
                        ‚ö†Ô∏è Blocked by WCAG AA (4.5:1 minimum)
                    </div>
                    <div class="auto-adjust-indicator" id="autoAdjustText">
                        ‚ú® Auto-adjusted for compliance
                    </div>
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Chroma (C)</span>
                        <span class="value-display" id="valueTextC">0.01</span>
                    </div>
                    <input type="range" class="slider" id="sliderTextC" min="0" max="37" value="1">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Hue (H)</span>
                        <span class="value-display" id="valueTextH">250¬∞</span>
                    </div>
                    <input type="range" class="slider" id="sliderTextH" min="0" max="360" value="250">
                </div>

                <div class="color-preview" id="previewText" style="background: var(--text); color: var(--bg);">
                    Text Sample
                    <span class="contrast-badge badge-pass" id="badgeText">‚úì AA</span>
                </div>
            </div>

            <!-- Primary Button (Constrained) -->
            <div class="section">
                <div class="section-title">Primary Button (Constrained)</div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Lightness (L)</span>
                        <span class="value-display" id="valuePrimaryL">60%</span>
                    </div>
                    <div class="slider-container">
                        <div class="legal-zone" id="legalZonePrimaryL"></div>
                        <input type="range" class="slider" id="sliderPrimaryL" min="0" max="100" value="60">
                    </div>
                    <div class="constraint-warning" id="warningPrimaryL">
                        ‚ö†Ô∏è Blocked by contrast requirements
                    </div>
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Chroma (C)</span>
                        <span class="value-display" id="valuePrimaryC">0.15</span>
                    </div>
                    <input type="range" class="slider" id="sliderPrimaryC" min="0" max="37" value="15">
                </div>

                <div class="control-group">
                    <div class="control-label">
                        <span>Hue (H)</span>
                        <span class="value-display" id="valuePrimaryH">240¬∞</span>
                    </div>
                    <input type="range" class="slider" id="sliderPrimaryH" min="0" max="360" value="240">
                </div>

                <div class="color-preview" id="previewPrimary" style="background: var(--primary); color: var(--primary-text);">
                    Button Text
                    <span class="contrast-badge badge-pass" id="badgePrimary">‚úì AA</span>
                </div>
            </div>

            <!-- 3D Zone Visualization -->
            <div class="section">
                <div class="section-title">Legal Zones (3D View)</div>
                <canvas id="canvas3d"></canvas>
                <div class="zone-legend">
                    <div class="legend-item">
                        <div class="legend-box legend-legal"></div>
                        <span>Legal (‚â•4.5:1)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box legend-illegal"></div>
                        <span>Illegal (<4.5:1)</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- CENTER: Live Preview -->
        <div class="preview-panel">
            <h1 class="preview-title">Live UI Preview</h1>

            <div class="component-demo">
                <div class="demo-title">Buttons</div>
                <button class="btn">Primary Button</button>
            </div>

            <div class="component-demo">
                <div class="demo-title">Cards</div>
                <div class="card">
                    <div class="card-title">Card Title</div>
                    <p class="card-text">This is card text. All colors automatically adjust to maintain readability.</p>
                </div>
            </div>

            <div class="component-demo" style="background: var(--bg);">
                <div class="demo-title">Text on Background</div>
                <p style="color: var(--text); font-size: 1.1rem; line-height: 1.6;">
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. This text automatically adjusts its lightness to maintain WCAG AA compliance with the background color.
                </p>
                <p style="color: var(--text-secondary); font-size: 0.95rem; margin-top: 1rem;">
                    Secondary text also maintains compliance automatically.
                </p>
            </div>
        </div>

        <!-- RIGHT: Relationship Graph & Compliance -->
        <div class="panel">
            <h1>üîó Color Relationships</h1>

            <div class="relationship-graph">
                <div class="relationship">
                    <div class="rel-color" style="background: var(--bg);"></div>
                    <span class="rel-arrow">‚Üí</span>
                    <div class="rel-color" style="background: var(--text);"></div>
                    <div class="rel-info">
                        <div>Background ‚Üí Text</div>
                        <div class="rel-ratio pass" id="ratioText">7.2:1 ‚úì</div>
                    </div>
                </div>

                <div class="relationship">
                    <div class="rel-color" style="background: var(--primary);"></div>
                    <span class="rel-arrow">‚Üí</span>
                    <div class="rel-color" style="background: var(--primary-text);"></div>
                    <div class="rel-info">
                        <div>Button ‚Üí Button Text</div>
                        <div class="rel-ratio pass" id="ratioPrimary">8.1:1 ‚úì</div>
                    </div>
                </div>

                <div class="relationship">
                    <div class="rel-color" style="background: var(--bg);"></div>
                    <span class="rel-arrow">‚Üí</span>
                    <div class="rel-color" style="background: var(--primary);"></div>
                    <div class="rel-info">
                        <div>Background ‚Üí Button</div>
                        <div class="rel-ratio pass" id="ratioBgPrimary">5.3:1 ‚úì</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Constraint Status</div>
                <div style="font-size: 0.85rem; line-height: 1.8; color: var(--text-secondary);">
                    <div id="statusText">‚úì All relationships compliant</div>
                    <div id="statusBlocked" style="color: oklch(65% 0.18 25); display: none;">
                        ‚ö†Ô∏è Some values blocked
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">System Behavior</div>
                <div style="font-size: 0.8rem; line-height: 1.6; color: var(--text-secondary);">
                    ‚Ä¢ <strong>Guardrails:</strong> Sliders snap to legal values<br>
                    ‚Ä¢ <strong>Auto-Adjust:</strong> Dependent colors recalculate<br>
                    ‚Ä¢ <strong>Real-Time:</strong> All constraints enforced live<br>
                    ‚Ä¢ <strong>WCAG AA:</strong> 4.5:1 minimum enforced
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // ===============================================================
        // CONSTRAINT ENGINE - OKLCH with WCAG/APCA Enforcement
        // ===============================================================

        // OKLCH to relative luminance
        function oklchToLuminance(l) {
            // Simplified: L in OKLCH ‚âà perceptual lightness
            // For WCAG, we need relative luminance Y
            // Approximate: Y ‚âà L^2 (perceptually uniform to photometric)
            return Math.pow(l, 2);
        }

        // WCAG Contrast Ratio
        function getContrastRatio(l1, l2) {
            const y1 = oklchToLuminance(l1);
            const y2 = oklchToLuminance(l2);
            const lighter = Math.max(y1, y2);
            const darker = Math.min(y1, y2);
            return (lighter + 0.05) / (darker + 0.05);
        }

        // Calculate legal lightness range for given background
        function getLegalLightnessRange(bgL, minContrast = 4.5) {
            const bgY = oklchToLuminance(bgL);

            // Calculate bounds
            const lighterY = (minContrast * (bgY + 0.05)) - 0.05;
            const darkerY = ((bgY + 0.05) / minContrast) - 0.05;

            // Convert back to OKLCH lightness
            const lighterL = Math.sqrt(Math.max(0, lighterY));
            const darkerL = Math.sqrt(Math.max(0, darkerY));

            return {
                min: Math.max(0, darkerL),
                max: Math.min(1, lighterL),
                isValid: lighterL > darkerL
            };
        }

        // ===============================================================
        // STATE MANAGEMENT
        // ===============================================================

        const state = {
            bg: { l: 0.15, c: 0.01, h: 250 },
            text: { l: 0.95, c: 0.01, h: 250 },
            primary: { l: 0.60, c: 0.15, h: 240 },
            primaryText: { l: 1.0, c: 0, h: 0 }
        };

        // ===============================================================
        // CONSTRAINT ENFORCEMENT
        // ===============================================================

        function enforceTextConstraints() {
            const legalRange = getLegalLightnessRange(state.bg.l, 4.5);

            // If current text lightness is outside legal range, AUTO-ADJUST
            if (state.text.l < legalRange.min) {
                state.text.l = legalRange.min;
                document.getElementById('autoAdjustText').classList.add('active');
                setTimeout(() => {
                    document.getElementById('autoAdjustText').classList.remove('active');
                }, 2000);
            } else if (state.text.l > legalRange.max) {
                state.text.l = legalRange.max;
                document.getElementById('autoAdjustText').classList.add('active');
                setTimeout(() => {
                    document.getElementById('autoAdjustText').classList.remove('active');
                }, 2000);
            }

            // Update slider
            document.getElementById('sliderTextL').value = state.text.l * 100;

            // Show legal zone on slider
            const legalZone = document.getElementById('legalZoneTextL');
            const sliderWidth = document.getElementById('sliderTextL').offsetWidth;
            legalZone.style.left = (legalRange.min * sliderWidth / 1.0) + 'px';
            legalZone.style.width = ((legalRange.max - legalRange.min) * sliderWidth / 1.0) + 'px';
        }

        function enforcePrimaryConstraints() {
            // Primary button must be visible against background
            const legalRange = getLegalLightnessRange(state.bg.l, 3.0); // Slightly lower for non-text

            if (state.primary.l < legalRange.min) {
                state.primary.l = legalRange.min;
            } else if (state.primary.l > legalRange.max) {
                state.primary.l = legalRange.max;
            }

            // Button text must be readable on button
            const textLegalRange = getLegalLightnessRange(state.primary.l, 4.5);
            if (state.primaryText.l < textLegalRange.min) {
                state.primaryText.l = textLegalRange.min;
            } else if (state.primaryText.l > textLegalRange.max) {
                state.primaryText.l = textLegalRange.max;
            }

            document.getElementById('sliderPrimaryL').value = state.primary.l * 100;

            // Show legal zone
            const legalZone = document.getElementById('legalZonePrimaryL');
            const sliderWidth = document.getElementById('sliderPrimaryL').offsetWidth;
            legalZone.style.left = (legalRange.min * sliderWidth / 1.0) + 'px';
            legalZone.style.width = ((legalRange.max - legalRange.min) * sliderWidth / 1.0) + 'px';
        }

        // ===============================================================
        // UI UPDATE
        // ===============================================================

        function updateUI() {
            // Apply colors
            const bgColor = `oklch(${(state.bg.l * 100).toFixed(1)}% ${state.bg.c.toFixed(3)} ${state.bg.h.toFixed(0)})`;
            const textColor = `oklch(${(state.text.l * 100).toFixed(1)}% ${state.text.c.toFixed(3)} ${state.text.h.toFixed(0)})`;
            const primaryColor = `oklch(${(state.primary.l * 100).toFixed(1)}% ${state.primary.c.toFixed(3)} ${state.primary.h.toFixed(0)})`;
            const primaryTextColor = `oklch(${(state.primaryText.l * 100).toFixed(1)}% ${state.primaryText.c.toFixed(3)} ${state.primaryText.h.toFixed(0)})`;

            document.documentElement.style.setProperty('--bg', bgColor);
            document.documentElement.style.setProperty('--text', textColor);
            document.documentElement.style.setProperty('--primary', primaryColor);
            document.documentElement.style.setProperty('--primary-text', primaryTextColor);

            // Update value displays
            document.getElementById('valueBgL').textContent = (state.bg.l * 100).toFixed(0) + '%';
            document.getElementById('valueBgC').textContent = state.bg.c.toFixed(2);
            document.getElementById('valueBgH').textContent = state.bg.h.toFixed(0) + '¬∞';

            document.getElementById('valueTextL').textContent = (state.text.l * 100).toFixed(0) + '%';
            document.getElementById('valueTextC').textContent = state.text.c.toFixed(2);
            document.getElementById('valueTextH').textContent = state.text.h.toFixed(0) + '¬∞';

            document.getElementById('valuePrimaryL').textContent = (state.primary.l * 100).toFixed(0) + '%';
            document.getElementById('valuePrimaryC').textContent = state.primary.c.toFixed(2);
            document.getElementById('valuePrimaryH').textContent = state.primary.h.toFixed(0) + '¬∞';

            // Update contrast ratios
            const textRatio = getContrastRatio(state.text.l, state.bg.l);
            const primaryRatio = getContrastRatio(state.primaryText.l, state.primary.l);
            const bgPrimaryRatio = getContrastRatio(state.primary.l, state.bg.l);

            document.getElementById('ratioText').textContent = textRatio.toFixed(1) + ':1 ' + (textRatio >= 4.5 ? '‚úì' : '‚úó');
            document.getElementById('ratioText').className = 'rel-ratio ' + (textRatio >= 4.5 ? 'pass' : 'fail');

            document.getElementById('ratioPrimary').textContent = primaryRatio.toFixed(1) + ':1 ' + (primaryRatio >= 4.5 ? '‚úì' : '‚úó');
            document.getElementById('ratioPrimary').className = 'rel-ratio ' + (primaryRatio >= 4.5 ? 'pass' : 'fail');

            document.getElementById('ratioBgPrimary').textContent = bgPrimaryRatio.toFixed(1) + ':1 ' + (bgPrimaryRatio >= 3.0 ? '‚úì' : '‚úó');
            document.getElementById('ratioBgPrimary').className = 'rel-ratio ' + (bgPrimaryRatio >= 3.0 ? 'pass' : 'fail');

            // Update badges
            const badgeText = document.getElementById('badgeText');
            badgeText.textContent = textRatio >= 4.5 ? '‚úì AA' : '‚úó Fail';
            badgeText.className = 'contrast-badge ' + (textRatio >= 4.5 ? 'badge-pass' : 'badge-fail');

            const badgePrimary = document.getElementById('badgePrimary');
            badgePrimary.textContent = primaryRatio >= 4.5 ? '‚úì AA' : '‚úó Fail';
            badgePrimary.className = 'contrast-badge ' + (primaryRatio >= 4.5 ? 'badge-pass' : 'badge-fail');
        }

        // ===============================================================
        // EVENT LISTENERS
        // ===============================================================

        // Background controls
        document.getElementById('sliderBgL').addEventListener('input', (e) => {
            state.bg.l = parseFloat(e.target.value) / 100;
            enforceTextConstraints();
            enforcePrimaryConstraints();
            updateUI();
        });

        document.getElementById('sliderBgC').addEventListener('input', (e) => {
            state.bg.c = parseFloat(e.target.value) / 100;
            updateUI();
        });

        document.getElementById('sliderBgH').addEventListener('input', (e) => {
            state.bg.h = parseFloat(e.target.value);
            updateUI();
        });

        // Text controls (with guardrails)
        document.getElementById('sliderTextL').addEventListener('input', (e) => {
            let requested = parseFloat(e.target.value) / 100;
            const legalRange = getLegalLightnessRange(state.bg.l, 4.5);

            // GUARDRAIL: Clamp to legal range
            if (requested < legalRange.min) {
                requested = legalRange.min;
                e.target.value = requested * 100;
                document.getElementById('warningTextL').classList.add('active');
            } else if (requested > legalRange.max) {
                requested = legalRange.max;
                e.target.value = requested * 100;
                document.getElementById('warningTextL').classList.add('active');
            } else {
                document.getElementById('warningTextL').classList.remove('active');
            }

            state.text.l = requested;
            updateUI();
        });

        document.getElementById('sliderTextC').addEventListener('input', (e) => {
            state.text.c = parseFloat(e.target.value) / 100;
            updateUI();
        });

        document.getElementById('sliderTextH').addEventListener('input', (e) => {
            state.text.h = parseFloat(e.target.value);
            updateUI();
        });

        // Primary controls (with guardrails)
        document.getElementById('sliderPrimaryL').addEventListener('input', (e) => {
            let requested = parseFloat(e.target.value) / 100;
            const legalRange = getLegalLightnessRange(state.bg.l, 3.0);

            // GUARDRAIL
            if (requested < legalRange.min) {
                requested = legalRange.min;
                e.target.value = requested * 100;
                document.getElementById('warningPrimaryL').classList.add('active');
            } else if (requested > legalRange.max) {
                requested = legalRange.max;
                e.target.value = requested * 100;
                document.getElementById('warningPrimaryL').classList.add('active');
            } else {
                document.getElementById('warningPrimaryL').classList.remove('active');
            }

            state.primary.l = requested;
            enforcePrimaryConstraints(); // Also adjust button text
            updateUI();
        });

        document.getElementById('sliderPrimaryC').addEventListener('input', (e) => {
            state.primary.c = parseFloat(e.target.value) / 100;
            updateUI();
        });

        document.getElementById('sliderPrimaryH').addEventListener('input', (e) => {
            state.primary.h = parseFloat(e.target.value);
            updateUI();
        });

        // Initialize
        enforceTextConstraints();
        enforcePrimaryConstraints();
        updateUI();

        console.log('‚úÖ OKLCH Constrained System OPERATIONAL!');
        console.log('üõ°Ô∏è Guardrails: Active');
        console.log('üîó Relationships: Enforced');
        console.log('‚ú® Auto-Adjustment: Enabled');
    </script>
</body>
</html>
