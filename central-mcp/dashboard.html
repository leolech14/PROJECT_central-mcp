
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Central-MCP System Dashboard</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      margin: 0;
      padding: 2rem;
    }
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
    }
    .panel {
      background-color: #1e1e1e;
      border-radius: 8px;
      padding: 1.5rem;
      border: 1px solid #333;
    }
    h2 {
      margin-top: 0;
      color: #bb86fc;
    }
    .log-container {
      height: 300px;
      overflow-y: scroll;
      background-color: #000;
      padding: 1rem;
      border-radius: 4px;
      font-family: 'SF Mono', Consolas, monospace;
      font-size: 0.85rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 0.5rem;
      text-align: left;
      border-bottom: 1px solid #333;
    }
  </style>
</head>
<body>
  <h1>ðŸ§  Central-MCP System Dashboard</h1>
  <p style="color: #888; margin-top: -1rem; margin-bottom: 2rem;">Real-time monitoring and control for the auto-proactive intelligence ecosystem</p>

  <div class="dashboard">
    <div class="panel">
      <h2>ðŸ”„ Agent Activity Monitor</h2>
      <div id="engine-status"></div>
    </div>

    <div class="panel">
      <h2>ðŸ“‹ Task Progress Overview</h2>
      <div id="task-queue"></div>
    </div>

    <div class="panel">
      <h2>ðŸ¤– Agent Status Roster</h2>
      <div id="agent-roster"></div>
    </div>

    <div class="panel">
      <h2>ðŸš€ Recent Project Activity</h2>
      <div id="recent-projects"></div>
    </div>

    <div class="panel" style="grid-column: 1 / -1;">
      <h2>Live Log Stream (coming soon)</h2>
      <div class="log-container" id="log-stream"></div>
    </div>
  </div>

  <script>
    const engineStatusDiv = document.getElementById('engine-status');
    const taskQueueDiv = document.getElementById('task-queue');
    const agentRosterDiv = document.getElementById('agent-roster');

    async function fetchStatus() {
      try {
        const response = await fetch('http://localhost:3001/api/system/status');
        const data = await response.json();

        // Render Engine Status (Recent Agent Activity)
        let engineHtml = '<table>';
        engineHtml += '<tr><th>Agent</th><th>Activity</th><th>Timestamp</th></tr>';
        for (const activity of data.engineStatus) {
          const time = new Date(activity.timestamp).toLocaleTimeString();
          const agentBadge = `<span style="color: #bb86fc; font-weight: bold;">${activity.agent_letter}</span>`;
          const activityType = `<span style="color: ${activity.activity_type === 'CONNECT' ? '#4caf50' : activity.activity_type === 'DISCONNECT' ? '#f44336' : '#2196f3'}">${activity.activity_type}</span>`;
          engineHtml += `<tr><td>${agentBadge}</td><td>${activityType}</td><td>${time}</td></tr>`;
        }
        engineHtml += '</table>';
        engineStatusDiv.innerHTML = engineHtml;

        // Render Task Queue
        let taskHtml = '<div style="margin-bottom: 1rem;"><strong>Total Tasks: ' + data.tasks.total + '</strong></div>';
        taskHtml += '<table>';
        taskHtml += '<tr><th>Status</th><th>Count</th><th>Progress</th></tr>';
        for (const status of data.tasks.byStatus) {
          const percentage = Math.round((status.count / data.tasks.total) * 100);
          const progressBar = `<div style="width: 100px; height: 8px; background: #333; border-radius: 4px; overflow: hidden;">
            <div style="width: ${percentage}%; height: 100%; background: ${status.status === 'COMPLETE' ? '#4caf50' : status.status === 'AVAILABLE' ? '#2196f3' : '#ff9800'}; transition: width 0.3s;"></div>
          </div>`;
          taskHtml += `<tr><td>${status.status}</td><td>${status.count}</td><td>${progressBar}</td></tr>`;
        }
        taskHtml += '</table>';
        taskQueueDiv.innerHTML = taskHtml;

        // Render Agent Roster
        let agentHtml = '<table>';
        agentHtml += '<tr><th>Agent</th><th>Status</th><th>Session Time</th><th>Last Seen</th></tr>';
        for (const agent of data.agents) {
          const statusColor = agent.status === 'ONLINE' ? '#4caf50' : '#666';
          const statusBadge = `<span style="color: ${statusColor}; font-weight: bold;">${agent.status}</span>`;
          const agentBadge = `<span style="color: #bb86fc; font-weight: bold;">Agent ${agent.agent_letter}</span>`;
          const sessionTime = agent.total_active_time_minutes + 'm';
          const lastSeen = new Date(agent.last_seen).toLocaleString();

          agentHtml += `<tr>
            <td>${agentBadge}</td>
            <td>${statusBadge}</td>
            <td>${sessionTime}</td>
            <td>${lastSeen}</td>
          </tr>`;
        }
        agentHtml += '</table>';
        agentRosterDiv.innerHTML = agentHtml;

        // Render Recent Projects
        if (data.recentProjects && data.recentProjects.length > 0) {
          const projectsDiv = document.getElementById('recent-projects');
          if (projectsDiv) {
            let projectsHtml = '<table>';
            projectsHtml += '<tr><th>Project</th><th>Type</th><th>Last Activity</th></tr>';
            for (const project of data.recentProjects) {
              const typeColor = project.type === 'COMMERCIAL_APP' ? '#4caf50' :
                              project.type === 'INFRASTRUCTURE' ? '#2196f3' : '#ff9800';
              const lastActivity = new Date(project.last_activity).toLocaleString();

              projectsHtml += `<tr>
                <td><strong>${project.name}</strong></td>
                <td><span style="color: ${typeColor};">${project.type.replace('_', ' ')}</span></td>
                <td>${lastActivity}</td>
              </tr>`;
            }
            projectsHtml += '</table>';
            projectsDiv.innerHTML = projectsHtml;
          }
        }

      } catch (error) {
        console.error('Error fetching system status:', error);
        engineStatusDiv.innerHTML = '<p>Error fetching status.</p>';
        taskQueueDiv.innerHTML = '<p>Error fetching status.</p>';
        agentRosterDiv.innerHTML = '<p>Error fetching status.</p>';
      }
    }

    // Fetch status every 5 seconds
    fetchStatus();
    setInterval(fetchStatus, 5000);
  </script>
</body>
</html>
